<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U FORNU | Restaurant Traditionnel Corse Ã  Calcatoggio</title>
    <meta name="description" content="U FORNU d'Antony - Restaurant traditionnel et pizzeria Ã  Calcatoggio. SpÃ©cialitÃ©s corses, pizzas au feu de bois, produits locaux entre Ajaccio et Sagone.">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <style>
        /* ... styles prÃ©cÃ©dents ... */

        /* Ajout d'animations pour le chat */
        .message-animation {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Style amÃ©liorÃ© pour les suggestions de rÃ©ponse */
        .suggestion-chip {
            display: inline-block;
            padding: 8px 16px;
            margin: 4px;
            background-color: #f0f0f0;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .suggestion-chip:hover {
            background-color: #e0e0e0;
        }
    </style>
</head>
<body>
    <!-- ... HTML prÃ©cÃ©dent ... -->

<script>
// Structure de donnÃ©es pour la gestion des conversations
const ConversationContext = {
    conversationStarted: false,
    lastTopic: null,
    questionCount: 0,
    suggestedNextTopics: [],
    userSatisfied: false,
    needsChefContact: false
};

// Base de connaissances complÃ¨te
const KnowledgeBase = {
    pizzas: {
        baseTomate: [
            { nom: "Marguerite", ingredients: ["tomate", "fromage"], prix: 9.50 },
            { nom: "Jambon Fromage", ingredients: ["tomate", "jambon", "fromage"], prix: 10.00 },
            { nom: "Romaine", ingredients: ["tomate", "anchois", "cÃ¢pres"], prix: 10.00 },
            { nom: "Napolitaine", ingredients: ["tomate", "anchois", "cÃ¢pres", "fromage"], prix: 10.80 },
            { nom: "Reine", ingredients: ["tomate", "jambon", "champignons", "fromage"], prix: 11.00 },
            { nom: "Chorizo", ingredients: ["tomate", "chorizo", "champignons", "fromage"], prix: 11.50 },
            { nom: "Roi", ingredients: ["tomate", "jambon", "champignons", "Å“uf", "fromage"], prix: 11.50 },
            { nom: "ComplÃ¨te", ingredients: ["tomate", "jambon", "champignons", "anchois", "Å“uf", "fromage"], prix: 11.80 },
            { nom: "Italiana", ingredients: ["tomate", "pepperoni", "champignons", "fromage"], prix: 12.00 },
            { nom: "Corsica", ingredients: ["tomate", "jambon", "champignons", "Å“uf", "figatellu", "fromage"], prix: 12.60 },
            { nom: "Special Fornu", ingredients: ["tomate", "jambon de Parme", "champignons", "roquette", "fromage"], prix: 13.00 }
        ],
        baseCreme: [
            { nom: "Reine Blanche", ingredients: ["crÃ¨me fraÃ®che", "jambon", "champignons", "fromage"], prix: 11.50 },
            { nom: "Dame Blanche", ingredients: ["crÃ¨me fraÃ®che", "jambon", "champignons", "Å“uf", "fromage"], prix: 11.80 },
            { nom: "Poulet Curry", ingredients: ["crÃ¨me fraÃ®che", "poulet", "champignons", "fromage", "curry"], prix: 12.00 }
        ]
    },
    contact: {
        telephone: "+33621146462",
        horaires_appel: "Ã  partir de 17h",
        adresse: "Calcatoggio village",
        maps_url: "https://maps.app.goo.gl/QQiBsitH5hcmQViTA",
    },
    horaires: {
        ouverture: "18h30",
        fermeture: "22h00",
        jours: "du mardi au dimanche",
        periode: "de fin mai au 11 novembre",
        specificites: "fermÃ© le lundi"
    },
    produits_locaux: {
        liqueurs: ["cÃ©drat", "cafÃ©", "myrte", "limoncello"],
        charcuteries: ["figatellu", "coppa", "lonzu", "prisuttu"],
        autres: ["confitures maison", "produits corses traditionnels"]
    }
};

// SystÃ¨me de rÃ©ponses avancÃ©
const responses = {
    accueil: () => `Bonghjornu ! ğŸŒ

Je suis lÃ  pour vous renseigner sur U FORNU, le restaurant d'Antony Ã  Calcatoggio. 
Je peux vous parler de :
â€¢ Nos dÃ©licieuses pizzas ğŸ•
â€¢ Nos horaires et localisation ğŸ“
â€¢ Nos produits locaux ğŸ‡«ğŸ‡·
â€¢ RÃ©servations et commandes ğŸ“

Voici la suite du code avec les rÃ©ponses intelligentes du chatbot :

```javascript
// Suite des rÃ©ponses avancÃ©es
const responses = {
    // ... suite des rÃ©ponses prÃ©cÃ©dentes ...

    carte_pizzas: `ğŸ“‹ DÃ©couvrez nos pizzas, prÃ©parÃ©es avec passion par Antony :

BASE TOMATE :
â€¢ Marguerite (tomate, fromage) - 9,50â‚¬
â€¢ Jambon Fromage - 10,00â‚¬
â€¢ Romaine (tomate, anchois, cÃ¢pres) - 10,00â‚¬
â€¢ Napolitaine (tomate, anchois, cÃ¢pres, fromage) - 10,80â‚¬
â€¢ Reine (tomate, jambon champignons, fromage) - 11,00â‚¬
â€¢ Chorizo (tomate, chorizo, champignons, fromage) - 11,50â‚¬
â€¢ Roi (tomate, jambon, champignons, Å“uf, fromage) - 11,50â‚¬
â€¢ ComplÃ¨te (tomate, jambon, champignons, anchois, Å“uf, fromage) - 11,80â‚¬
â€¢ Italiana (tomate, pepperoni, champignons, fromage) - 12,00â‚¬
â€¢ Corsica (tomate, jambon, champignons, Å“uf, figatellu, fromage) - 12,60â‚¬
â€¢ Special Fornu (tomate, jambon de Parme, champignons, roquette, fromage) - 13,00â‚¬

BASE CRÃˆME FRAÃCHE :
â€¢ Reine Blanche (crÃ¨me fraÃ®che, jambon, champignons, fromage) - 11,50â‚¬
â€¢ Dame Blanche (crÃ¨me fraÃ®che, jambon, champignons, Å“uf, fromage) - 11,80â‚¬
â€¢ Poulet Curry (crÃ¨me fraÃ®che, poulet, champignons, fromage, curry) - 12,00â‚¬

ğŸ’¡ Toutes nos pizzas peuvent Ãªtre personnalisÃ©es selon vos envies !
ğŸ“ Pour commander : ${KnowledgeBase.contact.telephone} (${KnowledgeBase.contact.horaires_appel})

Puis-je vous donner plus de dÃ©tails sur une pizza en particulier ? ğŸ˜Š`,

    localisation: `ğŸ“ U FORNU vous accueille Ã  Calcatoggio village :

â€¢ Entre Ajaccio (25 min) et Sagone (10 min)
â€¢ Au cÅ“ur du village
â€¢ Vue panoramique sur le Golfe

ğŸ—ºï¸ Google Maps : ${KnowledgeBase.contact.maps_url}
â˜ï¸ Contact : ${KnowledgeBase.contact.telephone} (${KnowledgeBase.contact.horaires_appel})

Besoin d'indications plus prÃ©cises ? ğŸ˜Š`,

    horaires: `â° Nos horaires d'ouverture :

â€¢ ${KnowledgeBase.horaires.jours}
â€¢ Service : ${KnowledgeBase.horaires.ouverture} - ${KnowledgeBase.horaires.fermeture}
â€¢ ${KnowledgeBase.horaires.specificites}
â€¢ Ouvert ${KnowledgeBase.horaires.periode}

ğŸ“ RÃ©servation conseillÃ©e au ${KnowledgeBase.contact.telephone}
(joignable ${KnowledgeBase.contact.horaires_appel})

Souhaitez-vous que je vous aide pour une rÃ©servation ? ğŸ¤—`,

    produits_locaux: `ğŸ‡«ğŸ‡· Nos produits artisanaux, disponibles toute l'annÃ©e :

LIQUEURS MAISON :
${KnowledgeBase.produits_locaux.liqueurs.map(l => `â€¢ ${l}`).join('\n')}

CHARCUTERIES CORSES :
${KnowledgeBase.produits_locaux.charcuteries.map(c => `â€¢ ${c}`).join('\n')}

AUTRES SPÃ‰CIALITÃ‰S :
${KnowledgeBase.produits_locaux.autres.map(a => `â€¢ ${a}`).join('\n')}

ğŸ“¦ ExpÃ©dition possible dans toute la France
ğŸ“ Contactez Antony pour plus d'infos : ${KnowledgeBase.contact.telephone}

Que souhaitez-vous dÃ©couvrir ? ğŸ˜Š`,

    contact_chef: `Pour parler directement avec Antony :

ğŸ“ Appelez le ${KnowledgeBase.contact.telephone}
â° ${KnowledgeBase.contact.horaires_appel}

Il se fera un plaisir de vous renseigner personnellement ! ğŸ‘¨â€ğŸ³`,

    ne_comprend_pas: `Je ne suis pas sÃ»r de bien comprendre votre demande... ğŸ¤”

Je peux vous parler de :
â€¢ Nos pizzas et la carte
â€¢ Les horaires et l'adresse
â€¢ Les rÃ©servations
â€¢ Nos produits locaux

Ou prÃ©fÃ©rez-vous parler directement Ã  Antony ? ğŸ“`,

    au_revoir: `Je vous remercie de votre intÃ©rÃªt pour U FORNU ! ğŸ™

Antony et son Ã©quipe seront ravis de vous accueillir.
N'hÃ©sitez pas Ã  revenir si vous avez d'autres questions.

Ã€ dopu ! ğŸ‘‹`,

    verification_satisfaction: `Ai-je rÃ©pondu Ã  toutes vos questions ? 
Je peux vous aider pour autre chose ou vous mettre en contact avec Antony si vous le souhaitez. ğŸ˜Š`,

    suggestion_contact: `Pour cette demande spÃ©cifique, je vous conseille de contacter directement Antony au ${KnowledgeBase.contact.telephone} (${KnowledgeBase.contact.horaires_appel}). Il sera le mieux placÃ© pour vous rÃ©pondre ! ğŸ‘¨â€ğŸ³`
};

// Fonction d'analyse du contexte
function analyzeContext(input, context) {
    input = input.toLowerCase();
    
    // DÃ©tection de fin de conversation
    if (input.includes("merci") || input.includes("au revoir") || input.includes("a plus") || 
        input.includes("Ã  plus") || input.includes("bye") || input.includes("adieu") || 
        input.includes("Ã  dopu")) {
        return { intent: "fin_conversation" };
    }

    // DÃ©tection de confusion
    if (input.includes("je ne comprends pas") || input.includes("pas clair") || 
        input.includes("quoi") || input.length < 4) {
        return { intent: "confusion" };
    }

    // DÃ©tection besoin de contact direct
    if (input.includes("parler") || input.includes("directement") || input.includes("chef") || 
        input.includes("antony") || context.questionCount > 3) {
        return { intent: "contact_direct" };
    }

    // ... autres dÃ©tections de contexte ...

    return { intent: "information_standard" };
}

// Fonction principale de rÃ©ponse
function getBotResponse(input, context) {
    const analysis = analyzeContext(input, context);

    // Mise Ã  jour du contexte
    context.questionCount++;
    input = input.toLowerCase();

    // Gestion des intentions spÃ©cifiques
    switch(analysis.intent) {
        case "fin_conversation":
            return responses.au_revoir;
        case "confusion":
            return responses.ne_comprend_pas;
        case "contact_direct":
            return responses.contact_chef;
    }

    // RÃ©ponses spÃ©cifiques selon le contenu
    if (input.includes("pizza") || input.includes("carte") || input.includes("menu"))
        return responses.carte_pizzas;
    if (input.includes("oÃ¹") || input.includes("adresse") || input.includes("lieu"))
        return responses.localisation;
    if (input.includes("horaire") || input.includes("ouvert"))
        return responses.horaires;
    if (input.includes("produit") || input.includes("local") || input.includes("corse"))
        return responses.produits_locaux;

    // Si on ne comprend pas bien la demande
    if (context.questionCount > 2) {
        return responses.suggestion_contact;
    }

    return responses.verification_satisfaction;
}

Voici la suite avec la partie React et l'interface interactive :

```javascript
// Composant React du ChatBot
const ChatBot = () => {
    const [messages, setMessages] = React.useState([{
        text: responses.accueil(),
        sender: 'bot'
    }]);
    const [input, setInput] = React.useState('');
    const [context, setContext] = React.useState({
        conversationStarted: false,
        lastTopic: null,
        questionCount: 0,
        suggestedNextTopics: [],
        userSatisfied: false
    });

    // RÃ©fÃ©rence pour le scroll automatique
    const messagesEndRef = React.useRef(null);
    const scrollToBottom = () => {
        messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
    };

    React.useEffect(() => {
        scrollToBottom();
    }, [messages]);

    // Suggestions rapides selon le contexte
    const getSuggestions = (lastMessage) => {
        if (!lastMessage) return [];
        
        const suggestions = [];
        if (lastMessage.includes("pizza")) {
            suggestions.push("Voir toutes les pizzas", "Prix des pizzas", "Pizza sans fromage");
        }
        if (lastMessage.includes("horaire")) {
            suggestions.push("RÃ©server une table", "Comment venir", "Appeler le restaurant");
        }
        if (lastMessage.includes("produit")) {
            suggestions.push("Voir les liqueurs", "Charcuterie", "ExpÃ©dition");
        }
        return suggestions;
    };

    const handleSuggestionClick = (suggestion) => {
        handleUserMessage(suggestion);
    };

    const handleUserMessage = (userText) => {
        const newMessages = [...messages, { text: userText, sender: 'user' }];
        setMessages(newMessages);
        
        // Mise Ã  jour du contexte
        const newContext = {...context};
        newContext.questionCount++;
        newContext.lastTopic = userText;
        setContext(newContext);

        // RÃ©ponse du bot avec dÃ©lai naturel
        setTimeout(() => {
            const botResponse = getBotResponse(userText, newContext);
            setMessages(prev => [...prev, { text: botResponse, sender: 'bot' }]);
            
            // VÃ©rification de satisfaction aprÃ¨s plusieurs Ã©changes
            if (newContext.questionCount >= 3 && !newContext.userSatisfied) {
                setTimeout(() => {
                    setMessages(prev => [...prev, { 
                        text: responses.verification_satisfaction, 
                        sender: 'bot'
                    }]);
                }, 1000);
            }
        }, 800);

        setInput('');
    };

    const handleSubmit = (e) => {
        e.preventDefault();
        if (!input.trim()) return;
        handleUserMessage(input);
    };

    return React.createElement('div', { 
        style: { 
            height: '100%', 
            display: 'flex', 
            flexDirection: 'column' 
        }
    },
        // En-tÃªte du chat
        React.createElement('div', { 
            style: { 
                background: 'var(--color-shutter)',
                color: 'white',
                padding: '15px',
                textAlign: 'center',
                borderRadius: '15px 15px 0 0',
                fontWeight: 'bold'
            }
        }, "ğŸ’¬ U FORNU - Discussion avec notre assistant"),

        // Zone des messages
        React.createElement('div', { 
            style: { 
                flex: 1,
                overflow: 'auto',
                padding: '15px',
                background: '#f8f9fa'
            }
        },
            messages.map((msg, idx) => 
                React.createElement('div', { 
                    key: idx,
                    className: 'message-animation',
                    style: {
                        textAlign: msg.sender === 'user' ? 'right' : 'left',
                        margin: '8px'
                    }
                },
                    React.createElement('span', {
                        style: {
                            background: msg.sender === 'user' ? 'var(--color-accent)' : 'white',
                            color: msg.sender === 'user' ? 'white' : 'var(--color-text)',
                            padding: '12px 18px',
                            borderRadius: '20px',
                            display: 'inline-block',
                            maxWidth: '80%',
                            boxShadow: '0 2px 5px rgba(0,0,0,0.1)',
                            wordWrap: 'break-word'
                        }
                    }, msg.text),
                    
                    // Suggestions aprÃ¨s les messages du bot
                    msg.sender === 'bot' && getSuggestions(msg.text).length > 0 ?
                        React.createElement('div', {
                            style: {
                                marginTop: '8px',
                                display: 'flex',
                                flexWrap: 'wrap',
                                gap: '8px'
                            }
                        },
                            getSuggestions(msg.text).map((suggestion, i) =>
                                React.createElement('button', {
                                    key: i,
                                    className: 'suggestion-chip',
                                    onClick: () => handleSuggestionClick(suggestion)
                                }, suggestion)
                            )
                        )
                    : null
                )
            ),
            React.createElement('div', { ref: messagesEndRef })
        ),

        // Formulaire de saisie
        React.createElement('form', { 
            onSubmit: handleSubmit,
            style: { 
                padding: '15px',
                background: 'white',
                borderTop: '1px solid #eee',
                borderRadius: '0 0 15px 15px'
            }
        },
            React.createElement('div', { 
                style: { 
                    display: 'flex', 
                    gap: '10px' 
                }
            },
                React.createElement('input', {
                    value: input,
                    onChange: (e) => setInput(e.target.value),
                    placeholder: "Posez votre question...",
                    style: {
                        flex: 1,
                        padding: '12px',
                        borderRadius: '25px',
                        border: '1px solid #ddd',
                        outline: 'none',
                        fontSize: '16px'
                    }
                }),
                React.createElement('button', {
                    type: 'submit',
                    style: {
                        padding: '12px 24px',
                        borderRadius: '25px',
                        border: 'none',
                        background: 'var(--color-accent)',
                        color: 'white',
                        cursor: 'pointer',
                        fontSize: '16px',
                        fontWeight: 'bold'
                    }
                }, "Envoyer")
            )
        )
    );
};

// Initialisation du chat
document.addEventListener('DOMContentLoaded', () => {
    const chatButton = document.getElementById('chat-button');
    const chatContainer = document.getElementById('chat');
    let chatVisible = false;

    chatButton.addEventListener('click', () => {
        chatVisible = !chatVisible;
        chatContainer.style.display = chatVisible ? 'block' : 'none';
    });

    ReactDOM.render(
        React.createElement(ChatBot),
        document.getElementById('chat')
    );
});
</script>
</body>
</html>
